<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Health & Safety Dashboard</title>
  
  <!-- Bootstrap CSS for layout & styling -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.2.1/dist/chart.umd.min.js"></script>
  
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <style>
    body {
      margin: 20px;
      background-color: #f9f9f9;
      font-family: sans-serif;
    }
    .badge-custom {
      display: inline-block;
      padding: 0.4em 0.8em;
      border-radius: 0.25rem;
      font-weight: 500;
      font-size: 0.9em;
      min-width: 100px;
      text-align: center;
      color: #fff;
      margin-right: 5px;
    }
    .comp-green, .risk-green { background-color: #28a745; }
    .comp-amber, .risk-amber { background-color: #ffc107; color: #000; }
    .comp-red, .risk-red { background-color: #dc3545; }
    .comp-unknown, .risk-unknown { background-color: #6c757d; }

    .hse-card {
      cursor: pointer;
      transition: transform 0.2s ease;
      margin-bottom: 20px;
    }
    .hse-card:hover {
      transform: scale(1.02);
    }
    .card {
      display: flex;
      flex-direction: column;
    }
    .card-header {
      font-weight: bold;
      text-align: center;
      height: 50px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .card-body {
      text-align: center;
      flex-grow: 1;
    }
    .details-section {
      margin-top: 10px;
    }
    .nav-tabs .nav-link {
      font-size: 1.1em;
      font-weight: bold;
    }
    .click-indicator {
      text-align: center; 
      font-size: 1.4em; 
      color: #999; 
      margin-top: 10px;
    }
    /* Key styling */
    .dashboard-key {
      max-width: 600px;
      margin: 30px auto;
    }
  </style>
</head>
<body>

<div class="container-fluid">
  <h1 class="my-4">Health & Safety Dashboard</h1>

  <!-- Tabbed interface -->
  <ul class="nav nav-tabs" id="dashboardTabs" role="tablist">
    
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="construction_&_estate-tab" data-bs-toggle="tab" data-bs-target="#construction_&_estate" type="button" role="tab" aria-controls="construction_&_estate" aria-selected="true">
        CONSTRUCTION & ESTATE
      </button>
    </li>
    
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="university_health_&_safety_management-tab" data-bs-toggle="tab" data-bs-target="#university_health_&_safety_management" type="button" role="tab" aria-controls="university_health_&_safety_management" aria-selected="false">
        UNIVERSITY HEALTH & SAFETY MANAGEMENT
      </button>
    </li>
    
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="faculty/professional_services_health_&_safety_management-tab" data-bs-toggle="tab" data-bs-target="#faculty/professional_services_health_&_safety_management" type="button" role="tab" aria-controls="faculty/professional_services_health_&_safety_management" aria-selected="false">
        FACULTY/PROFESSIONAL SERVICES HEALTH & SAFETY MANAGEMENT
      </button>
    </li>
    
  </ul>

  <div class="tab-content" id="dashboardTabsContent">
    
    <div class="tab-pane fade show active" id="construction_&_estate" role="tabpanel" aria-labelledby="construction_&_estate-tab">
      
    <div class="row my-4">
      <div class="col-md-6 d-flex flex-column align-items-center">
        <div id="complianceChartContainer_construction_&_estate">
          <canvas id="complianceChart_construction_&_estate"></canvas>
        </div>
      </div>
      <div class="col-md-6 d-flex flex-column align-items-center">
        <div id="riskChartContainer_construction_&_estate">
          <canvas id="riskChart_construction_&_estate"></canvas>
        </div>
      </div>
    </div>
    
      
    <div class="mb-3 text-center">
      <button class="btn btn-primary me-2 sortAscBtn" data-tab="construction_&_estate">Sort Compliance: Red to Green</button>
      <button class="btn btn-primary me-2 sortDescBtn" data-tab="construction_&_estate">Sort Compliance: Green to Red</button>
    </div>
    <div class="mb-3 text-center">
      <button class="btn btn-primary me-2 sortRiskAscBtn" data-tab="construction_&_estate">Sort Residual Risk: Red to Green</button>
      <button class="btn btn-primary sortRiskDescBtn" data-tab="construction_&_estate">Sort Residual Risk: Green to Red</button>
    </div>
    
      <div id="cardsContainer_construction_&_estate" class="row">
        
        <div class="col-md-3">
          <div class="card hse-card">
            <div class="card-header">Asbestos management</div>
            <div class="card-body">
              <span class="badge-custom">Amber</span>
              <span class="badge-custom">Green</span>
              <p><strong>Deadline to Green:</strong> 2025-07-01 00:00:00</p>
              <div class="details-section" style="display:none;">
                <hr>
                <p><strong>Controls/Comments:</strong><br>Surveys in place. Re-surveying in place. UoN staff trained to P405.</p>
              </div>
              <div class="click-indicator">&#x25BC;</div>
            </div>
          </div>
        </div>
        
        <div class="col-md-3">
          <div class="card hse-card">
            <div class="card-header">Fire Assets</div>
            <div class="card-body">
              <span class="badge-custom">Amber</span>
              <span class="badge-custom">Amber</span>
              <p><strong>Deadline to Green:</strong> 2025-12-01 00:00:00</p>
              <div class="details-section" style="display:none;">
                <hr>
                <p><strong>Controls/Comments:</strong><br>Testing of E/L & Fire alarms undertaken & recorded. New company engaged to undertake FD surveys.</p>
              </div>
              <div class="click-indicator">&#x25BC;</div>
            </div>
          </div>
        </div>
        
        <div class="col-md-3">
          <div class="card hse-card">
            <div class="card-header">Fire Risk Assessments</div>
            <div class="card-body">
              <span class="badge-custom">Green</span>
              <span class="badge-custom">Green</span>
              <p><strong>Deadline to Green:</strong> 2025-08-01 00:00:00</p>
              <div class="details-section" style="display:none;">
                <hr>
                <p><strong>Controls/Comments:</strong><br>BAFE approved contractors appointed and on-site weekly review FRAs. All buildings have an FRA except one that is currently isolated. Some buildings require the assessment reviewing.</p>
              </div>
              <div class="click-indicator">&#x25BC;</div>
            </div>
          </div>
        </div>
        
        <div class="col-md-3">
          <div class="card hse-card">
            <div class="card-header">Water Management inc. Legionella</div>
            <div class="card-body">
              <span class="badge-custom">Green</span>
              <span class="badge-custom">Green</span>
              <p><strong>Deadline to Green:</strong> 2025-07-01 00:00:00</p>
              <div class="details-section" style="display:none;">
                <hr>
                <p><strong>Controls/Comments:</strong><br>Water Management compliance standard in place; all buildings have a water risk assessment; some require a review which will be undertaken by July. There is a program of water tank cleaning and hot and cold flushing</p>
              </div>
              <div class="click-indicator">&#x25BC;</div>
            </div>
          </div>
        </div>
        
        <div class="col-md-3">
          <div class="card hse-card">
            <div class="card-header">Electrical Safety</div>
            <div class="card-body">
              <span class="badge-custom">Amber</span>
              <span class="badge-custom">Amber</span>
              <p><strong>Deadline to Green:</strong> 2025-04-01 00:00:00</p>
              <div class="details-section" style="display:none;">
                <hr>
                <p><strong>Controls/Comments:</strong><br>Compliance standard in place; EICR undertaken and remedial actions managed. 78% of building have an in date EICR the remainder will be in date by the end of April.</p>
              </div>
              <div class="click-indicator">&#x25BC;</div>
            </div>
          </div>
        </div>
        
        <div class="col-md-3">
          <div class="card hse-card">
            <div class="card-header">Gas Safety</div>
            <div class="card-body">
              <span class="badge-custom">Amber</span>
              <span class="badge-custom">Amber</span>
              <p><strong>Deadline to Green:</strong> 2025-04-01 00:00:00</p>
              <div class="details-section" style="display:none;">
                <hr>
                <p><strong>Controls/Comments:</strong><br>Compliance standard in place. Gas audits undertaken on compressed gases in use in academic areas.  83% of building Gas safety certificates in date with the remainder in date by end of April 25</p>
              </div>
              <div class="click-indicator">&#x25BC;</div>
            </div>
          </div>
        </div>
        
        <div class="col-md-3">
          <div class="card hse-card">
            <div class="card-header">Statutory Inspections</div>
            <div class="card-body">
              <span class="badge-custom">Green</span>
              <span class="badge-custom">Green</span>
              <p><strong>Deadline to Green:</strong> Ongoing</p>
              <div class="details-section" style="display:none;">
                <hr>
                <p><strong>Controls/Comments:</strong><br>Allianz contract now being managed through HSD to ensure plant is available when engineers are on site and also any remedial advisories are actioned. Equipment also has maintenance contracts in place. The wider faculty asset register project being centralised on zeta safe has commenced.</p>
              </div>
              <div class="click-indicator">&#x25BC;</div>
            </div>
          </div>
        </div>
        
        <div class="col-md-3">
          <div class="card hse-card">
            <div class="card-header">Building Welfare Provision</div>
            <div class="card-body">
              <span class="badge-custom">Green</span>
              <span class="badge-custom">Green</span>
              <p><strong>Deadline to Green:</strong> N/A</p>
              <div class="details-section" style="display:none;">
                <hr>
                <p><strong>Controls/Comments:</strong><br>Buildings have suitably sized rooms, heating, lighting, toilets, drinking water</p>
              </div>
              <div class="click-indicator">&#x25BC;</div>
            </div>
          </div>
        </div>
        
        <div class="col-md-3">
          <div class="card hse-card">
            <div class="card-header">Site Transport Safety</div>
            <div class="card-body">
              <span class="badge-custom">Green</span>
              <span class="badge-custom">Green</span>
              <p><strong>Deadline to Green:</strong> 2026-07-01 00:00:00</p>
              <div class="details-section" style="display:none;">
                <hr>
                <p><strong>Controls/Comments:</strong><br>Driving at work policy in place; new driver permit system in process of being rolled out; campuses have road markings; site transport assessments are being refreshed.</p>
              </div>
              <div class="click-indicator">&#x25BC;</div>
            </div>
          </div>
        </div>
        
        <div class="col-md-3">
          <div class="card hse-card">
            <div class="card-header">Construction Design and Maintenance</div>
            <div class="card-body">
              <span class="badge-custom">Unknown</span>
              <span class="badge-custom">Amber</span>
              <p><strong>Deadline to Green:</strong> N/A</p>
              <div class="details-section" style="display:none;">
                <hr>
                <p><strong>Controls/Comments:</strong><br>CDM policy in place. CDM process in Place; CDM metrics to be developed, no reported incidents</p>
              </div>
              <div class="click-indicator">&#x25BC;</div>
            </div>
          </div>
        </div>
        
        <div class="col-md-3">
          <div class="card hse-card">
            <div class="card-header">Control of Contractors</div>
            <div class="card-body">
              <span class="badge-custom">Amber</span>
              <span class="badge-custom">Green</span>
              <p><strong>Deadline to Green:</strong> 2026-07-01 00:00:00</p>
              <div class="details-section" style="display:none;">
                <hr>
                <p><strong>Controls/Comments:</strong><br>Control of Contractors compliance standards in place; Reset system used to ensure contractors are insured have rams and site inductions. The management of reset is managed locally. This needs to be rolled out across the wider university</p>
              </div>
              <div class="click-indicator">&#x25BC;</div>
            </div>
          </div>
        </div>
        
        <div class="col-md-3">
          <div class="card hse-card">
            <div class="card-header">Permit to Work Compliance</div>
            <div class="card-body">
              <span class="badge-custom">Amber</span>
              <span class="badge-custom">Amber</span>
              <p><strong>Deadline to Green:</strong> 2026-07-01 00:00:00</p>
              <div class="details-section" style="display:none;">
                <hr>
                <p><strong>Controls/Comments:</strong><br>Permit to work compliance standards are in place for hot works, confined spaces, work at height, excavations, restricted high-risk areas, asbestos, electrical working. Permits are being developed for isolating fire detection and fire compartmentation working. Estates confined work register is currently being reassessed.</p>
              </div>
              <div class="click-indicator">&#x25BC;</div>
            </div>
          </div>
        </div>
        
      </div>
    </div>
    
    <div class="tab-pane fade" id="university_health_&_safety_management" role="tabpanel" aria-labelledby="university_health_&_safety_management-tab">
      
    <div class="row my-4">
      <div class="col-md-6 d-flex flex-column align-items-center">
        <div id="complianceChartContainer_university_health_&_safety_management">
          <canvas id="complianceChart_university_health_&_safety_management"></canvas>
        </div>
      </div>
      <div class="col-md-6 d-flex flex-column align-items-center">
        <div id="riskChartContainer_university_health_&_safety_management">
          <canvas id="riskChart_university_health_&_safety_management"></canvas>
        </div>
      </div>
    </div>
    
      
    <div class="mb-3 text-center">
      <button class="btn btn-primary me-2 sortAscBtn" data-tab="university_health_&_safety_management">Sort Compliance: Red to Green</button>
      <button class="btn btn-primary me-2 sortDescBtn" data-tab="university_health_&_safety_management">Sort Compliance: Green to Red</button>
    </div>
    <div class="mb-3 text-center">
      <button class="btn btn-primary me-2 sortRiskAscBtn" data-tab="university_health_&_safety_management">Sort Residual Risk: Red to Green</button>
      <button class="btn btn-primary sortRiskDescBtn" data-tab="university_health_&_safety_management">Sort Residual Risk: Green to Red</button>
    </div>
    
      <div id="cardsContainer_university_health_&_safety_management" class="row">
        
        <div class="col-md-3">
          <div class="card hse-card">
            <div class="card-header">Health & Safety Policy in place</div>
            <div class="card-body">
              <span class="badge-custom">Amber</span>
              <span class="badge-custom">Green</span>
              <p><strong>Deadline to Green:</strong> N/A</p>
              <div class="details-section" style="display:none;">
                <hr>
                <p><strong>Controls/Comments:</strong><br>Annual Review of University level Health and Safety Policy</p>
              </div>
              <div class="click-indicator">&#x25BC;</div>
            </div>
          </div>
        </div>
        
        <div class="col-md-3">
          <div class="card hse-card">
            <div class="card-header">Health & Safety Compliance Standards providing Topic guidance</div>
            <div class="card-body">
              <span class="badge-custom">Amber</span>
              <span class="badge-custom">Amber</span>
              <p><strong>Deadline to Green:</strong> Ongoing program of review</p>
              <div class="details-section" style="display:none;">
                <hr>
                <p><strong>Controls/Comments:</strong><br>A full suite of topic-based health and safety compliance standards are in place that are reviewed on an ongoing basis and checked legal standards</p>
              </div>
              <div class="click-indicator">&#x25BC;</div>
            </div>
          </div>
        </div>
        
        <div class="col-md-3">
          <div class="card hse-card">
            <div class="card-header">Health & Safety Central Training Course</div>
            <div class="card-body">
              <span class="badge-custom">Green</span>
              <span class="badge-custom">Green</span>
              <p><strong>Deadline to Green:</strong> 2025-09-01 00:00:00</p>
              <div class="details-section" style="display:none;">
                <hr>
                <p><strong>Controls/Comments:</strong><br>The current suite of central health and safety courses are in place and delivered. The Health and Safety Committee have agreed the role out of more topic specific training that is required. With the records managed through Unicore</p>
              </div>
              <div class="click-indicator">&#x25BC;</div>
            </div>
          </div>
        </div>
        
        <div class="col-md-3">
          <div class="card hse-card">
            <div class="card-header">Health & Safety incident reporting & Investigation</div>
            <div class="card-body">
              <span class="badge-custom">Green</span>
              <span class="badge-custom">Green</span>
              <p><strong>Deadline to Green:</strong> 2026-03-01 00:00:00</p>
              <div class="details-section" style="display:none;">
                <hr>
                <p><strong>Controls/Comments:</strong><br>There is a system for reporting incidents and conducting investigations. The system is old and requires updating.</p>
              </div>
              <div class="click-indicator">&#x25BC;</div>
            </div>
          </div>
        </div>
        
        <div class="col-md-3">
          <div class="card hse-card">
            <div class="card-header">Health & Safety Auditing and Safety inspections undertaken</div>
            <div class="card-body">
              <span class="badge-custom">Amber</span>
              <span class="badge-custom">Amber</span>
              <p><strong>Deadline to Green:</strong> 2025-03-01 00:00:00</p>
              <div class="details-section" style="display:none;">
                <hr>
                <p><strong>Controls/Comments:</strong><br>Audit Program in place and started and the HSD are undertaking spot inspections monthly. The residual risk refers to the potential for when improvements are required.</p>
              </div>
              <div class="click-indicator">&#x25BC;</div>
            </div>
          </div>
        </div>
        
        <div class="col-md-3">
          <div class="card hse-card">
            <div class="card-header">Health & Safety Action Implementations – from Fire risk assessment actions; risk assessments; audits; inspections; statutory inspections; investigations; risk management system</div>
            <div class="card-body">
              <span class="badge-custom">Amber</span>
              <span class="badge-custom">Amber</span>
              <p><strong>Deadline to Green:</strong> 2025-09-01 00:00:00</p>
              <div class="details-section" style="display:none;">
                <hr>
                <p><strong>Controls/Comments:</strong><br>There is currently no one system for overseeing the implementation of actions. There are several systems that rely on human interaction. Which makes the holistic monitoring difficult. The move forward is to identify a system to act as the one source of truth for monitoring all actions</p>
              </div>
              <div class="click-indicator">&#x25BC;</div>
            </div>
          </div>
        </div>
        
      </div>
    </div>
    
    <div class="tab-pane fade" id="faculty/professional_services_health_&_safety_management" role="tabpanel" aria-labelledby="faculty/professional_services_health_&_safety_management-tab">
      
    <div class="row my-4">
      <div class="col-md-6 d-flex flex-column align-items-center">
        <div id="complianceChartContainer_faculty/professional_services_health_&_safety_management">
          <canvas id="complianceChart_faculty/professional_services_health_&_safety_management"></canvas>
        </div>
      </div>
      <div class="col-md-6 d-flex flex-column align-items-center">
        <div id="riskChartContainer_faculty/professional_services_health_&_safety_management">
          <canvas id="riskChart_faculty/professional_services_health_&_safety_management"></canvas>
        </div>
      </div>
    </div>
    
      
    <div class="mb-3 text-center">
      <button class="btn btn-primary me-2 sortAscBtn" data-tab="faculty/professional_services_health_&_safety_management">Sort Compliance: Red to Green</button>
      <button class="btn btn-primary me-2 sortDescBtn" data-tab="faculty/professional_services_health_&_safety_management">Sort Compliance: Green to Red</button>
    </div>
    <div class="mb-3 text-center">
      <button class="btn btn-primary me-2 sortRiskAscBtn" data-tab="faculty/professional_services_health_&_safety_management">Sort Residual Risk: Red to Green</button>
      <button class="btn btn-primary sortRiskDescBtn" data-tab="faculty/professional_services_health_&_safety_management">Sort Residual Risk: Green to Red</button>
    </div>
    
      <div id="cardsContainer_faculty/professional_services_health_&_safety_management" class="row">
        
        <div class="col-md-3">
          <div class="card hse-card">
            <div class="card-header">Local Health & Safety Arrangements in place</div>
            <div class="card-body">
              <span class="badge-custom">Green</span>
              <span class="badge-custom">Unknown</span>
              <p><strong>Deadline to Green:</strong> N/A</p>
              <div class="details-section" style="display:none;">
                <hr>
                <p><strong>Controls/Comments:</strong><br>Health and Safety arrangements are in place and need to be reviewed annually or following an organisational change</p>
              </div>
              <div class="click-indicator">&#x25BC;</div>
            </div>
          </div>
        </div>
        
        <div class="col-md-3">
          <div class="card hse-card">
            <div class="card-header">Health & Safety Risk Assessment Registers in Place and up to date</div>
            <div class="card-body">
              <span class="badge-custom">Amber</span>
              <span class="badge-custom">Green</span>
              <p><strong>Deadline to Green:</strong> 2026-08-01 00:00:00</p>
              <div class="details-section" style="display:none;">
                <hr>
                <p><strong>Controls/Comments:</strong><br>Risk Registers are in place in Faculties and Professional Services, the next stage is to ensure the individual assessments have been reviewed and audited to show they meet the legal standard</p>
              </div>
              <div class="click-indicator">&#x25BC;</div>
            </div>
          </div>
        </div>
        
        <div class="col-md-3">
          <div class="card hse-card">
            <div class="card-header">Health & Safety Training Matrix in Place and monitored</div>
            <div class="card-body">
              <span class="badge-custom">Green</span>
              <span class="badge-custom">Green</span>
              <p><strong>Deadline to Green:</strong> N/A</p>
              <div class="details-section" style="display:none;">
                <hr>
                <p><strong>Controls/Comments:</strong><br>Training matrices in place in Faculty’s and professional Services and managed locally to ensure they are kept up to date. This will be moving to Unicore</p>
              </div>
              <div class="click-indicator">&#x25BC;</div>
            </div>
          </div>
        </div>
        
        <div class="col-md-3">
          <div class="card hse-card">
            <div class="card-header">Health & Safety Risk Management System Used to self-assess and manage locally</div>
            <div class="card-body">
              <span class="badge-custom">Green</span>
              <span class="badge-custom">Green</span>
              <p><strong>Deadline to Green:</strong> N/A</p>
              <div class="details-section" style="display:none;">
                <hr>
                <p><strong>Controls/Comments:</strong><br>The Risk Management system continues to be used for faculties and Professional services to conduct a self-assessment and manage any improvements required</p>
              </div>
              <div class="click-indicator">&#x25BC;</div>
            </div>
          </div>
        </div>
        
        <div class="col-md-3">
          <div class="card hse-card">
            <div class="card-header">Local Health & Safety Inspections undertaken</div>
            <div class="card-body">
              <span class="badge-custom">Amber</span>
              <span class="badge-custom">Green</span>
              <p><strong>Deadline to Green:</strong> 2026-08-01 00:00:00</p>
              <div class="details-section" style="display:none;">
                <hr>
                <p><strong>Controls/Comments:</strong><br>The KPI metrics return show that these are undertaken in the majority of the higher risk areas. Where it is not, they have this as an action. This is being built into the zeta safe system</p>
              </div>
              <div class="click-indicator">&#x25BC;</div>
            </div>
          </div>
        </div>
        
        <div class="col-md-3">
          <div class="card hse-card">
            <div class="card-header">Occupational Health Exposure Identified and Managed</div>
            <div class="card-body">
              <span class="badge-custom">Amber</span>
              <span class="badge-custom">Green</span>
              <p><strong>Deadline to Green:</strong> 2025-09-01 00:00:00</p>
              <div class="details-section" style="display:none;">
                <hr>
                <p><strong>Controls/Comments:</strong><br>Occupational Health exposure is identified locally and referred to the Occupational Health provider. With the upcoming change of provider there is a current campaign and audit process to test whether everyone that requires a referral for an occupational exposure has been referred</p>
              </div>
              <div class="click-indicator">&#x25BC;</div>
            </div>
          </div>
        </div>
        
      </div>
    </div>
    
  </div>
  
  <!-- Dashboard Key moved to bottom -->
  <div class="dashboard-key">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title text-center">Key</h5>
        <p class="card-text text-center">Below is a quick guide to the Residual Risk/Assurance levels:</p>
        <table class="table table-bordered">
          <tbody>
            <tr>
              <th style="background-color: #28a745; color: #fff; width: 100px;">Green</th>
              <td>Full Assurance / Low Risk — fully evidenced, adequate documentation; low likelihood of a serious incident.</td>
            </tr>
            <tr>
              <th style="background-color: #ffc107; color: #000;">Amber</th>
              <td>Partial Assurance / Moderate Risk — evidence of some documentation; moderate likelihood of a serious incident.</td>
            </tr>
            <tr>
              <th style="background-color: #dc3545; color: #fff;">Red</th>
              <td>No Assurance / Immediate Risk — no evidence of controls; high likelihood of a serious incident.</td>
            </tr>
            <tr>
              <th style="background-color: #6c757d; color: #fff;">Unknown</th>
              <td>Unknown Assurance / Risk — insufficient information to make a reliable assessment.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  
</div>

<!-- Bootstrap Bundle JS (includes Popper for tabs) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
  // Global dashboard data grouped by tab (generated from Excel)
  const dashboardDataByTab = {"construction_&_estate": [{"topic": "Asbestos management", "complianceRating": "Amber", "residualRisk": "Green", "deadlineToGreen": "2025-07-01 00:00:00", "controlsComments": "Surveys in place. Re-surveying in place. UoN staff trained to P405."}, {"topic": "Fire Assets", "complianceRating": "Amber", "residualRisk": "Amber", "deadlineToGreen": "2025-12-01 00:00:00", "controlsComments": "Testing of E/L & Fire alarms undertaken & recorded. New company engaged to undertake FD surveys."}, {"topic": "Fire Risk Assessments", "complianceRating": "Green", "residualRisk": "Green", "deadlineToGreen": "2025-08-01 00:00:00", "controlsComments": "BAFE approved contractors appointed and on-site weekly review FRAs. All buildings have an FRA except one that is currently isolated. Some buildings require the assessment reviewing."}, {"topic": "Water Management inc. Legionella", "complianceRating": "Green", "residualRisk": "Green", "deadlineToGreen": "2025-07-01 00:00:00", "controlsComments": "Water Management compliance standard in place; all buildings have a water risk assessment; some require a review which will be undertaken by July. There is a program of water tank cleaning and hot and cold flushing"}, {"topic": "Electrical Safety", "complianceRating": "Amber", "residualRisk": "Amber", "deadlineToGreen": "2025-04-01 00:00:00", "controlsComments": "Compliance standard in place; EICR undertaken and remedial actions managed. 78% of building have an in date EICR the remainder will be in date by the end of April."}, {"topic": "Gas Safety", "complianceRating": "Amber", "residualRisk": "Amber", "deadlineToGreen": "2025-04-01 00:00:00", "controlsComments": "Compliance standard in place. Gas audits undertaken on compressed gases in use in academic areas.  83% of building Gas safety certificates in date with the remainder in date by end of April 25"}, {"topic": "Statutory Inspections", "complianceRating": "Green", "residualRisk": "Green", "deadlineToGreen": "Ongoing", "controlsComments": "Allianz contract now being managed through HSD to ensure plant is available when engineers are on site and also any remedial advisories are actioned. Equipment also has maintenance contracts in place. The wider faculty asset register project being centralised on zeta safe has commenced."}, {"topic": "Building Welfare Provision", "complianceRating": "Green", "residualRisk": "Green", "deadlineToGreen": "N/A", "controlsComments": "Buildings have suitably sized rooms, heating, lighting, toilets, drinking water"}, {"topic": "Site Transport Safety", "complianceRating": "Green", "residualRisk": "Green", "deadlineToGreen": "2026-07-01 00:00:00", "controlsComments": "Driving at work policy in place; new driver permit system in process of being rolled out; campuses have road markings; site transport assessments are being refreshed."}, {"topic": "Construction Design and Maintenance", "complianceRating": "Unknown", "residualRisk": "Amber", "deadlineToGreen": "N/A", "controlsComments": "CDM policy in place. CDM process in Place; CDM metrics to be developed, no reported incidents"}, {"topic": "Control of Contractors", "complianceRating": "Amber", "residualRisk": "Green", "deadlineToGreen": "2026-07-01 00:00:00", "controlsComments": "Control of Contractors compliance standards in place; Reset system used to ensure contractors are insured have rams and site inductions. The management of reset is managed locally. This needs to be rolled out across the wider university"}, {"topic": "Permit to Work Compliance", "complianceRating": "Amber", "residualRisk": "Amber", "deadlineToGreen": "2026-07-01 00:00:00", "controlsComments": "Permit to work compliance standards are in place for hot works, confined spaces, work at height, excavations, restricted high-risk areas, asbestos, electrical working. Permits are being developed for isolating fire detection and fire compartmentation working. Estates confined work register is currently being reassessed."}], "university_health_&_safety_management": [{"topic": "Health & Safety Policy in place", "complianceRating": "Amber", "residualRisk": "Green", "deadlineToGreen": "N/A", "controlsComments": "Annual Review of University level Health and Safety Policy"}, {"topic": "Health & Safety Compliance Standards providing Topic guidance", "complianceRating": "Amber", "residualRisk": "Amber", "deadlineToGreen": "Ongoing program of review", "controlsComments": "A full suite of topic-based health and safety compliance standards are in place that are reviewed on an ongoing basis and checked legal standards"}, {"topic": "Health & Safety Central Training Course", "complianceRating": "Green", "residualRisk": "Green", "deadlineToGreen": "2025-09-01 00:00:00", "controlsComments": "The current suite of central health and safety courses are in place and delivered. The Health and Safety Committee have agreed the role out of more topic specific training that is required. With the records managed through Unicore"}, {"topic": "Health & Safety incident reporting & Investigation", "complianceRating": "Green", "residualRisk": "Green", "deadlineToGreen": "2026-03-01 00:00:00", "controlsComments": "There is a system for reporting incidents and conducting investigations. The system is old and requires updating."}, {"topic": "Health & Safety Auditing and Safety inspections undertaken", "complianceRating": "Amber", "residualRisk": "Amber", "deadlineToGreen": "2025-03-01 00:00:00", "controlsComments": "Audit Program in place and started and the HSD are undertaking spot inspections monthly. The residual risk refers to the potential for when improvements are required."}, {"topic": "Health & Safety Action Implementations \u2013 from Fire risk assessment actions; risk assessments; audits; inspections; statutory inspections; investigations; risk management system", "complianceRating": "Amber", "residualRisk": "Amber", "deadlineToGreen": "2025-09-01 00:00:00", "controlsComments": "There is currently no one system for overseeing the implementation of actions. There are several systems that rely on human interaction. Which makes the holistic monitoring difficult. The move forward is to identify a system to act as the one source of truth for monitoring all actions"}], "faculty/professional_services_health_&_safety_management": [{"topic": "Local Health & Safety Arrangements in place", "complianceRating": "Green", "residualRisk": "Unknown", "deadlineToGreen": "N/A", "controlsComments": "Health and Safety arrangements are in place and need to be reviewed annually or following an organisational change"}, {"topic": "Health & Safety Risk Assessment Registers in Place and up to date", "complianceRating": "Amber", "residualRisk": "Green", "deadlineToGreen": "2026-08-01 00:00:00", "controlsComments": "Risk Registers are in place in Faculties and Professional Services, the next stage is to ensure the individual assessments have been reviewed and audited to show they meet the legal standard"}, {"topic": "Health & Safety Training Matrix in Place and monitored", "complianceRating": "Green", "residualRisk": "Green", "deadlineToGreen": "N/A", "controlsComments": "Training matrices in place in Faculty\u2019s and professional Services and managed locally to ensure they are kept up to date. This will be moving to Unicore"}, {"topic": "Health & Safety Risk Management System Used to self-assess and manage locally", "complianceRating": "Green", "residualRisk": "Green", "deadlineToGreen": "N/A", "controlsComments": "The Risk Management system continues to be used for faculties and Professional services to conduct a self-assessment and manage any improvements required"}, {"topic": "Local Health & Safety Inspections undertaken", "complianceRating": "Amber", "residualRisk": "Green", "deadlineToGreen": "2026-08-01 00:00:00", "controlsComments": "The KPI metrics return show that these are undertaken in the majority of the higher risk areas. Where it is not, they have this as an action. This is being built into the zeta safe system"}, {"topic": "Occupational Health Exposure Identified and Managed", "complianceRating": "Amber", "residualRisk": "Green", "deadlineToGreen": "2025-09-01 00:00:00", "controlsComments": "Occupational Health exposure is identified locally and referred to the Occupational Health provider. With the upcoming change of provider there is a current campaign and audit process to test whether everyone that requires a referral for an occupational exposure has been referred"}]};
  // Global objects to store chart instances per tab
  const riskCharts = {};
  const complianceCharts = {};

  // Helper function to return the appropriate badge class
  function getBadgeClass(rating, type) {
    let r = rating.toLowerCase();
    if (r === "green") {
      return type === "compliance" ? "badge-custom comp-green" : "badge-custom risk-green";
    } else if (r === "amber") {
      return type === "compliance" ? "badge-custom comp-amber" : "badge-custom risk-amber";
    } else if (r === "red") {
      return type === "compliance" ? "badge-custom comp-red" : "badge-custom risk-red";
    } else {
      return type === "compliance" ? "badge-custom comp-unknown" : "badge-custom risk-unknown";
    }
  }

  // Build cards for a given tab into its container
  function buildCards(tabId, dataArray) {
    const container = document.getElementById("cardsContainer_" + tabId);
    let html = "";
    dataArray.forEach(item => {
      let compClass = getBadgeClass(item.complianceRating, "compliance");
      let riskClass = getBadgeClass(item.residualRisk, "risk");
      html += `
        <div class="col-md-3">
          <div class="card hse-card">
            <div class="card-header">${item.topic}</div>
            <div class="card-body">
              <span class="${compClass}">Compliance</span>
              <span class="${riskClass}">Residual Risk</span>
              <p><strong>Deadline to Green:</strong> ${item.deadlineToGreen}</p>
              <div class="details-section" style="display:none;">
                <hr>
                <p><strong>Controls/Comments:</strong><br>${item.controlsComments}</p>
              </div>
              <div class="click-indicator">&#x25BC;</div>
            </div>
          </div>
        </div>
      `;
    });
    container.innerHTML = html;

    // Add click toggling for card details
    container.querySelectorAll('.hse-card').forEach(card => {
      card.addEventListener('click', function() {
        const details = this.querySelector('.details-section');
        details.style.display = details.style.display === 'block' ? 'none' : 'block';
      });
    });
  }

  // Build the Residual Risk pie chart for a given tab
  function buildRiskChartForTab(tabId, dataArray) {
    const canvasId = 'riskChart_' + tabId;
    const canvasElem = document.getElementById(canvasId);
    if (!canvasElem) return;
    const ctx = canvasElem.getContext('2d');

    if (riskCharts[tabId]) {
      riskCharts[tabId].destroy();
    }

    const riskCounts = { Green: 0, Amber: 0, Red: 0, Unknown: 0 };
    dataArray.forEach(item => {
      const r = item.residualRisk;
      if (riskCounts.hasOwnProperty(r)) {
        riskCounts[r]++;
      } else {
        riskCounts.Unknown++;
      }
    });
    riskCharts[tabId] = new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: ['Green', 'Amber', 'Red', 'Unknown'],
        datasets: [{
          data: [riskCounts.Green, riskCounts.Amber, riskCounts.Red, riskCounts.Unknown],
          backgroundColor: ['#28a745', '#ffc107', '#dc3545', '#6c757d']
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'bottom' },
          title: { display: true, text: 'Residual Risk Distribution' }
        },
        onClick: function(evt, activeEls, chart) {
          if (activeEls.length > 0) {
            const index = activeEls[0].index;
            const risk = chart.data.labels[index];
            filterCardsByRisk(tabId, risk);
          }
        }
      }
    });
  }

  // Build the Compliance pie chart for a given tab
  function buildComplianceChartForTab(tabId, dataArray) {
    const canvasId = 'complianceChart_' + tabId;
    const canvasElem = document.getElementById(canvasId);
    if (!canvasElem) return;
    const ctx = canvasElem.getContext('2d');

    if (complianceCharts[tabId]) {
      complianceCharts[tabId].destroy();
    }

    const complianceCounts = { Green: 0, Amber: 0, Red: 0, Unknown: 0 };
    dataArray.forEach(item => {
      const c = item.complianceRating;
      if (complianceCounts.hasOwnProperty(c)) {
        complianceCounts[c]++;
      } else {
        complianceCounts.Unknown++;
      }
    });
    complianceCharts[tabId] = new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: ['Green', 'Amber', 'Red', 'Unknown'],
        datasets: [{
          data: [complianceCounts.Green, complianceCounts.Amber, complianceCounts.Red, complianceCounts.Unknown],
          backgroundColor: ['#28a745', '#ffc107', '#dc3545', '#6c757d']
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'bottom' },
          title: { display: true, text: 'Compliance Distribution' }
        },
        onClick: function(evt, activeEls, chart) {
          if (activeEls.length > 0) {
            const index = activeEls[0].index;
            const compliance = chart.data.labels[index];
            filterCardsByCompliance(tabId, compliance);
          }
        }
      }
    });
  }

  // Filter cards by Residual Risk
  function filterCardsByRisk(tabId, risk) {
    const allData = dashboardDataByTab[tabId];
    const filtered = allData.filter(item => item.residualRisk === risk);
    buildCards(tabId, filtered);
  }

  // Filter cards by Compliance
  function filterCardsByCompliance(tabId, compliance) {
    const allData = dashboardDataByTab[tabId];
    const filtered = allData.filter(item => item.complianceRating === compliance);
    buildCards(tabId, filtered);
  }

  // Reset the filter for a given tab (show all cards)
  function resetFilter(tabId) {
    buildCards(tabId, dashboardDataByTab[tabId]);
  }

  // Sorting order mapping for Compliance
  const complianceOrder = {
    "unknown": 1,
    "red": 2,
    "amber": 3,
    "green": 4
  };

  // Sorting order mapping for Residual Risk (can be adjusted as needed)
  const residualRiskOrder = {
    "unknown": 1,
    "red": 2,
    "amber": 3,
    "green": 4
  };

  // Sort cards by Compliance rating for a given tab
  function sortCardsByCompliance(tabId, order) {
    const data = dashboardDataByTab[tabId].slice();
    data.sort((a, b) => {
      const aVal = complianceOrder[a.complianceRating.toLowerCase()] || 0;
      const bVal = complianceOrder[b.complianceRating.toLowerCase()] || 0;
      return order === "asc" ? aVal - bVal : bVal - aVal;
    });
    buildCards(tabId, data);
  }

  // Sort cards by Residual Risk for a given tab
  function sortCardsByResidualRisk(tabId, order) {
    const data = dashboardDataByTab[tabId].slice();
    data.sort((a, b) => {
      const aVal = residualRiskOrder[a.residualRisk.toLowerCase()] || 0;
      const bVal = residualRiskOrder[b.residualRisk.toLowerCase()] || 0;
      return order === "asc" ? aVal - bVal : bVal - aVal;
    });
    buildCards(tabId, data);
  }

  // Initialize charts, cards, and event listeners for each tab on page load
  document.addEventListener('DOMContentLoaded', function() {
    for (const tabId in dashboardDataByTab) {
      buildCards(tabId, dashboardDataByTab[tabId]);
      buildRiskChartForTab(tabId, dashboardDataByTab[tabId]);
      buildComplianceChartForTab(tabId, dashboardDataByTab[tabId]);

      document.querySelectorAll(`.resetFilterBtn[data-tab="${tabId}"]`).forEach(btn => {
        btn.addEventListener('click', function() {
          resetFilter(tabId);
        });
      });
      document.querySelectorAll(`.sortAscBtn[data-tab="${tabId}"]`).forEach(btn => {
        btn.addEventListener('click', function() {
          sortCardsByCompliance(tabId, "asc");
        });
      });
      document.querySelectorAll(`.sortDescBtn[data-tab="${tabId}"]`).forEach(btn => {
        btn.addEventListener('click', function() {
          sortCardsByCompliance(tabId, "desc");
        });
      });
      document.querySelectorAll(`.sortRiskAscBtn[data-tab="${tabId}"]`).forEach(btn => {
        btn.addEventListener('click', function() {
          sortCardsByResidualRisk(tabId, "asc");
        });
      });
      document.querySelectorAll(`.sortRiskDescBtn[data-tab="${tabId}"]`).forEach(btn => {
        btn.addEventListener('click', function() {
          sortCardsByResidualRisk(tabId, "desc");
        });
      });
    }

    // Rebuild the charts when a tab is shown to ensure proper rendering.
    document.querySelectorAll('button[data-bs-toggle="tab"]').forEach(tabButton => {
      tabButton.addEventListener('shown.bs.tab', function (e) {
        const target = e.target.getAttribute('data-bs-target'); // e.g. "#tab_id"
        const tabId = target.substring(1); // remove '#' to get the id
        setTimeout(() => {
          buildRiskChartForTab(tabId, dashboardDataByTab[tabId]);
          buildComplianceChartForTab(tabId, dashboardDataByTab[tabId]);
        }, 100);
      });
    });
  });
</script>

</body>
</html>
